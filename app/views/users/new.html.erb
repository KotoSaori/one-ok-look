
  <!--f.submit はdoからendまでの間に一回しかつかえない-->
  
<h1>ユーザー管理</h1> 
<table>
	<thead>
		<tr>
		  <td colspan="2">CODE</td>
			<td colspan="8">部署</td>
			<td colspan="2">役職</td>
			<td colspan="8">氏名</td>
			<td colspan="2"></td>
		</tr>
	</thead>
	<tbody>
		<tr>
			<%= form_for @user do |f| %>
				<td colspan="2"><%= f.label :code %><%= f.text_field :code %></td>
				<td colspan="8"><%= f.label :section_id %><%= f.collection_select :section_id, Section.all, :id, :name, include_blank: "選択して下さい" %></td>
				<td colspan="2"><%= f.label :position_id %><%= f.collection_select :position_id, Position.all, :id, :name, include_blank: "選択して下さい" %></td>
				<td colspan="8"><%= f.label :name %><%= f.text_field :name %></td>
				<td colspan="2"><%= f.submit "登録" %></td>
			<% end %>
		</tr>
		
		<tr>
		  <td colspan="2">CODE</td>
			<td colspan="8">部署</td>
			<td colspan="2">役職</td>
			<td colspan="8">氏名</td>
			<td colspan="2"></td>
			<td colspan="2"></td>
		</tr>
		
		
		<% @users.each do |user| %>  
			<tr>
			    <td colspan="2"><%= text_field :user, :code, :id => "usercode" + user.id.to_s, :value => user.code, :readOnly => true %></td>
			    <td colspan="8"><%= text_field :user, :section_id, :id => "usersection"+ user.id.to_s, :value => user.section.name, :readOnly => true %></td>
			    <td colspan="2"><%= text_field :user, :position_id, :id => "userposition" + user.id.to_s, :value => user.position.name, :readOnly => true %></td>
			    <td colspan="8"><%= text_field :user, :name, :id => "username" + user.id.to_s, :value => user.name, :readOnly => true %></td>
			    <td colspan="2"><button class="edit_button" id="edit_button<%= user.id %>" data-id=<%= user.id %>>編集切替</button></td>
			    <td colspan="2"><button class="update_button" id="update_button<%= user.id %>" disabled data-id=<%= user.id %>>更新</button></td>
			    <td colspan="2"><button class="delete_button" id="delete_button<%= user.id %>" data-id=<%= user.id %>>削除</button></td>
		    </tr>
		<% end %>
		
		<script>
	　
	　	
	　// <---ここから---for文で繰り返し処理を試したが[var row.variable[i] = row.idvalue[i]+click;]のところでエラー--->
	 // var row = [
		//   {'variable': 'code_id', 'idvalue': 'usercode'},  // 0番目のオブジェクト変数
		//   {'variable': 'section_id', 'idvalue': 'usersection'},  // 1番目のオブジェクト変数
		//   {'variable': 'position_id', 'idvalue': 'userposition'},  // 2番目のオブジェクト変数
		//   {'variable': 'name_id', 'idvalue': 'username'},  // 3番目のオブジェクト変数
	 // ];
	  
	 // for (var i = 0; i < row.length; i++){
	　// // 指定ボタンを押下すると処理を開始する
	　// $('.button').on('click', function(){
  //          var click = $(this).data('id');
  //          var row.variable[i] = row.idvalue[i]+click;
  //          console.log(row.variable[i]);
		// 				if (document.getElementById(row.variable[i]).readOnly === true){
		// 					// readonly属性を削除
		// 						document.getElementById(row.variable[i]).removeAttribute("readOnly");
		// 						document.getElementById(row.variable[i]).style.background = "#FFFFE0";
		// 						document.getElementById(row.variable[i]).style.color = "black";
		// 				}else{
		// 					// readonly属性を設定
		// 						document.getElementById(row.variable[i]).setAttribute("readOnly", true);
		// 						document.getElementById(row.variable[i]).style.background = "#F0FFF0";
		// 						document.getElementById(row.variable[i]).style.color = "black";
		// 				}
  //    });
	 // }
	  //<---ここまで---for文で繰り返し処理トライして失敗--->
	  
	  
	  $('.edit_button').on('click', function(){
            var click =  $(this).data('id');
            var code_id = "usercode"+click;
            var edit_button_id = "edit_button"+click;
            var update_button_id = "update_button"+click;
            var delete_button_id = "delete_button"+click;
            // console.log(code_id);
            // console.log(edit_button_id);
            // console.log(update_button_id);
            // console.log(delete_button_id);
						if (document.getElementById(code_id).readOnly === true){
							// フィールド内のreadonly属性を削除
								document.getElementById(code_id).removeAttribute("readOnly");
								document.getElementById(code_id).style.background = "#EEEEEE";
								document.getElementById(code_id).style.color = "black";
						}else{
							// フィールド内のreadonly属性を設定
								document.getElementById(code_id).setAttribute("readOnly", true);
								document.getElementById(code_id).style.background = "White";
								document.getElementById(code_id).style.color = "black";
						}
						if (document.getElementById(code_id).readOnly === true){
								// 編集ボタンのdisabled属性を削除
								// document.getElementById(edit_button_id).removeAttribute("disabled");
								// document.getElementById(edit_button_id).style.color = "black";
								// 更新ボタンのdisabled属性を設定
								document.getElementById(update_button_id).setAttribute("disabled", true);
								document.getElementById(update_button_id).style.color = "White";
								// 削除ボタンのdisabled属性を削除
								document.getElementById(delete_button_id).removeAttribute("disabled");
								document.getElementById(delete_button_id).style.color = "black"
								
						}else{
						  	// 編集ボタンのdisabled属性を設定
								// document.getElementById(edit_button_id).setAttribute("disabled", true);
								// document.getElementById(edit_button_id).style.color = "White";
								// 更新ボタンのdisabled属性を設定
								document.getElementById(update_button_id).removeAttribute("disabled");
								document.getElementById(update_button_id).style.color = "black";
							  // 削除ボタンのdisabled属性を設定
								document.getElementById(delete_button_id).setAttribute("disabled", true);
								document.getElementById(delete_button_id).style.color = "White";
						}
      });
      
      
      $('.edit_button').on('click', function(){
            var click =  $(this).data('id');
            var section_id = "usersection"+click
            console.log(section_id)
						if (document.getElementById(section_id).readOnly === true){
							// readonly属性を削除
								document.getElementById(section_id).removeAttribute("readOnly");
								document.getElementById(section_id).style.background = "#EEEEEE";
								document.getElementById(section_id).style.color = "black";
						}else{
							// readonly属性を設定
								document.getElementById(section_id).setAttribute("readOnly", true);
								document.getElementById(section_id).style.background = "White";
								document.getElementById(section_id).style.color = "black";
						}
      });
      
      
      $('.edit_button').on('click', function(){
            var click = $(this).data('id');
            var position_id = "userposition"+click;
            console.log(position_id);
						if (document.getElementById(position_id).readOnly === true){
							// readonly属性を削除
								document.getElementById(position_id).removeAttribute("readOnly");
								document.getElementById(position_id).style.background = "#EEEEEE";
								document.getElementById(position_id).style.color = "black";
						}else{
							// readonly属性を設定
								document.getElementById(position_id).setAttribute("readOnly", true);
								document.getElementById(position_id).style.background = "White";
								document.getElementById(position_id).style.color = "black";
						}
      });
      
      
      $('.edit_button').on('click', function(){
            var click = $(this).data('id');
            var name_id = "username"+click;
            console.log(name_id);
						if (document.getElementById(name_id).readOnly === true){
							// readonly属性を削除
								document.getElementById(name_id).removeAttribute("readOnly");
								document.getElementById(name_id).style.background = "#EEEEEE";
								document.getElementById(name_id).style.color = "black";
						}else{
							// readonly属性を設定
								document.getElementById(name_id).setAttribute("readOnly", true);
								document.getElementById(name_id).style.background = "White";
								document.getElementById(name_id).style.color = "black";
						}
      });
      
      
		</script>
		
		
	</tbody>
</table>